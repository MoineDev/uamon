---
import Layout from "../../layouts/Layout.astro";
import servers from "../../data/servers.json";

export function getStaticPaths() {
  return servers.map((s) => ({
    params: { slug: s.slug },
    props: { server: s },
  }));
}

const { server } = Astro.props;
---

<Layout title={`${server.name} ‚Äî UAMON`}>
  <!-- –ü–µ—Ä–µ–¥–∞—î–º–æ API —Å—é–¥–∏ (–ù–ï –≤ body) -->
  <main class="mx-auto max-w-3xl px-4 py-8" data-api={server.api}>
    <a href="/" class="text-sm text-white/70 hover:text-white underline">‚Üê –ù–∞–∑–∞–¥</a>

    <div class="mt-4 rounded-2xl bg-neutral-800/60 border border-white/10 p-6">
      <div class="flex items-start gap-4">
        <img
          src={server.icon ? server.icon : "/icons/default.png"}
          alt={server.name}
          class="w-20 h-20 rounded-2xl object-cover bg-white/10 shrink-0"
          loading="lazy"
          onerror="this.onerror=null; this.src='/icons/default.png';"
        />

        <div class="min-w-0 flex-1">
          <div class="flex items-center gap-2">
            <h1 class="text-2xl font-extrabold text-white truncate">{server.name}</h1>
            <!-- –ö—Ä–∞–ø–∫–∞: —Å–ø–æ—á–∞—Ç–∫—É —Å—ñ—Ä–∞, –ø–æ—Ç—ñ–º —Å—Ç–∞–Ω–µ –∑–µ–ª–µ–Ω–∞/—á–µ—Ä–≤–æ–Ω–∞ -->
            <span class="status-dot w-3 h-3 rounded-full bg-gray-500 shrink-0"></span>
          </div>

          <p class="text-sm font-bold text-white/80 uppercase mt-1">{server.tags1}</p>
          <p class="text-sm font-bold text-white/60 uppercase">{server.tags2}</p>

          <div class="mt-3 flex flex-wrap items-center gap-3">
            <p class="text-sm text-white/90 truncate">IP:</p>
            <p class="text-sm text-white/90 truncate">{server.ip}</p>

            <button
              type="button"
              class="copy-ip px-3 py-1.5 rounded-lg text-xs font-semibold
                     bg-neutral-700/70 border border-white/10
                     text-white/90 hover:bg-neutral-700 hover:text-white
                     active:scale-[0.97] transition"
              data-ip={server.ip}
            >
              –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ IP
            </button>

            <span class="text-sm text-white/80">
              –û–Ω–ª–∞–π–Ω: <span class="js-online">‚Ä¶</span>
            </span>
          </div>
        </div>
      </div>

      {server.description && (
        <div class="mt-6">
          <h2 class="text-lg font-extrabold text-white">–û–ø–∏—Å</h2>
          <p class="mt-2 text-white/80 leading-relaxed whitespace-pre-line">
            {server.description}
          </p>

          {/*  –ë–õ–û–ö –ü–û–°–ò–õ–ê–ù–¨ */}
          {(
  server.website ||
  server.discord ||
  server.telegram ||
  server.youtube ||
  server.tiktok
) && (
  <div class="mt-6 rounded-xl border border-white/15 bg-neutral-900/60 backdrop-blur">
    <div class="border-b border-white/10 px-4 py-2 text-sm font-semibold text-white/70">
      –ü–æ—Å–∏–ª–∞–Ω–Ω—è
    </div>

    <div class="flex flex-col gap-1 p-3 text-sm">

      {server.website && (
        <a href={server.website} target="_blank"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/5 hover:text-white transition">
          üåê <span>–í–µ–±—Å–∞–π—Ç</span>
        </a>
      )}

      {server.discord && (
        <a href={server.discord} target="_blank"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/5 hover:text-white transition">
          üí¨ <span>Discord</span>
        </a>
      )}

      {server.telegram && (
        <a href={server.telegram} target="_blank"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/5 hover:text-white transition">
          ‚úàÔ∏è <span>Telegram</span>
        </a>
      )}

      {server.youtube && (
        <a href={server.youtube} target="_blank"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/5 hover:text-white transition">
          ‚ñ∂Ô∏è <span>YouTube</span>
        </a>
      )}

      {server.tiktok && (
        <a href={server.tiktok} target="_blank"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-white/80 hover:bg-white/5 hover:text-white transition">
          üéµ <span>TikTok</span>
        </a>
      )}

    </div>
  </div>

              </div>
            </div>
          )}
        </div>
      )}
    </div>

    <!-- –û–î–ò–ù —Å–∫—Ä–∏–ø—Ç: –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è + –æ–Ω–ª–∞–π–Ω + –∫—Ä–∞–ø–∫–∞ -->
    <script is:inline>
      (function () {
        const root = document.querySelector("main[data-api]");
        if (!root) return;

        // 1) Copy IP
        const copyBtn = root.querySelector(".copy-ip");
        if (copyBtn) {
          copyBtn.addEventListener("click", async () => {
            const ip = copyBtn.dataset.ip || "";
            try {
              await navigator.clipboard.writeText(ip);
              const oldText = copyBtn.textContent;
              copyBtn.textContent = "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!";
              copyBtn.classList.add("text-green-400");
              setTimeout(() => {
                copyBtn.textContent = oldText;
                copyBtn.classList.remove("text-green-400");
              }, 1500);
            } catch (e) {
              alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏. –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É: " + ip);
            }
          });
        }

        // 2) Online + dot
        async function loadOnline() {
          const api = root.dataset.api;
          const onlineEl = root.querySelector(".js-online");
          const dotEl = root.querySelector(".status-dot");

          if (!api || !onlineEl || !dotEl) return;

          try {
            const res = await fetch(api, { cache: "no-store" });
            const data = await res.json();

            const isUp = data?.online === true;
            const online = data?.players?.online ?? 0;
            const max = data?.players?.max ?? 0;

            onlineEl.textContent = isUp ? `${online}/${max}` : "–æ—Ñ–ª–∞–π–Ω";

            dotEl.classList.remove("bg-gray-500", "bg-green-500", "bg-red-500");
            dotEl.classList.add(isUp ? "bg-green-500" : "bg-red-500");
          } catch (e) {
            onlineEl.textContent = "‚Äî";
            dotEl.classList.remove("bg-green-500", "bg-red-500");
            dotEl.classList.add("bg-gray-500");
          }
        }

        loadOnline();
      })();
    </script>
  </main>
</Layout>