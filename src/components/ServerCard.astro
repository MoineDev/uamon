---
const { server } = Astro.props;
---

<div
  data-server-card
  data-api={server.api}
  class="rounded-2xl bg-neutral-800/60 border border-white/10 p-4 flex gap-4 items-start">
  <!-- Icon -->
  <div class="w-16 h-16 rounded-xl bg-white shrink-0"></div>

  <!-- Content -->
  <div class="flex-1 min-w-0">
    <div class="flex items-center gap-2">
      <h3 class="text-white font-extrabold text-xl leading-none truncate">
        {server.name}
      </h3>

<div class="flex items-center gap-2">
  <h3 class="text-white font-extrabold text-xl leading-none truncate">
    {server.name}
  </h3>

  <span class="status-dot w-3 h-3 rounded-full bg-gray-500 shrink-0"></span>
</div>

    </div>

    <p class="text-sm font-bold text-white/80 uppercase truncate mt-1">{server.tags1}</p>
    <p class="text-sm font-bold text-white/60 uppercase truncate">{server.tags2}</p>

    <div class="mt-2 flex items-center justify-between gap-3">
      <p class="text-sm text-white mt-1">
  {server.ip}
</p>
<button
  class="mt-2 text-xs text-neutral-300 hover:text-white underline"
  data-ip={server.ip}
  onclick="copyIp(this)"
>
  Скопіювати IP
</button>
      <p class="text-sm text-white/80">
  Онлайн: <span class="js-online">офлайн</span>
</p>
    </div>
  </div>
</div>
<script>
  function copyIp(button) {
    const ip = button.dataset.ip;

    navigator.clipboard.writeText(ip).then(() => {
      const oldText = button.textContent;
      button.textContent = "Скопійовано!";
      button.classList.add("text-green-400");

      setTimeout(() => {
        button.textContent = oldText;
        button.classList.remove("text-green-400");
      }, 1500);
    });
  }

  window.copyIp = copyIp;
</script>
<script>
  async function loadOnline(cardEl) {
    const api = cardEl.dataset.api;
    const onlineEl = cardEl.querySelector(".js-online");
    const dot = cardEl.querySelector(".status-dot");

    try {
      const res = await fetch(api);
      const data = await res.json();

      const isOnline = data?.online === true;
      const online = data?.players?.online ?? 0;
      const max = data?.players?.max ?? 0;

      if (isOnline) {
        onlineEl.textContent = `${online}/${max}`;
        dot.className = "status-dot w-3 h-3 rounded-full bg-green-500 shrink-0";
        cardEl.classList.remove("opacity-60");
      } else {
        onlineEl.textContent = "офлайн";
        dot.className = "status-dot w-3 h-3 rounded-full bg-red-500 shrink-0";
        cardEl.classList.add("opacity-60");
      }
    } catch {
      onlineEl.textContent = "офлайн";
      dot.className = "status-dot w-3 h-3 rounded-full bg-red-500 shrink-0";
      cardEl.classList.add("opacity-60");
    }
  }

  document
    .querySelectorAll("[data-server-card]")
    document.querySelectorAll("[data-server-card]").forEach((card) => {
  loadOnline(card);
  setInterval(() => loadOnline(card), 30000); // 30 секунд
});
</script>