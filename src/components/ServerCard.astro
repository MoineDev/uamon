---
const { server } = Astro.props;
---

<a
  href={`/server/${server.slug}`}
  data-server-card
  data-api={server.api}
  data-ip={server.ip}
  class="block rounded-2xl bg-neutral-800/60 border border-white/10
         p-4 flex gap-4 items-start
         hover:bg-neutral-800/80 transition cursor-pointer"
>
  <!-- Icon -->
  <img
    src={server.icon || "/icons/default.png"}
    alt={server.name}
    class="w-16 h-16 rounded-xl object-cover bg-white/10 shrink-0"
    loading="lazy"
    onerror="this.onerror=null; this.src='/icons/default.png';"
  />

  <!-- Content -->
  <div class="flex-1 min-w-0">
    <div class="flex items-center gap-2">
      <h3 class="text-white font-extrabold text-xl leading-none truncate">
        {server.name}
      </h3>

      <span class="status-dot w-3 h-3 rounded-full bg-gray-500 shrink-0"></span>
    </div>

    <p class="text-sm font-bold text-white/80 uppercase truncate mt-1">
      {server.tags1}
    </p>
    <p class="text-sm font-bold text-white/60 uppercase truncate">
      {server.tags2}
    </p>

    <div class="mt-2 flex flex-wrap items-center gap-3">
      <!-- IP -->
      <p class="text-sm text-white/90 truncate flex items-center gap-2">
        <i class="fa-solid fa-server text-white/60"></i>
        <span>{server.ip}</span>
      </p>

      <!-- Copy button -->
      <button
        type="button"
        class="copy-ip px-3 py-1.5 rounded-lg text-xs font-semibold
               bg-neutral-700/70 border border-white/10
               text-white/90 hover:bg-neutral-700 hover:text-white
               active:scale-[0.97] transition flex items-center gap-2"
        data-ip={server.ip}
      >
        <i class="fa-solid fa-copy"></i>
        Скопіювати IP
      </button>

      <!-- Online -->
      <p class="text-sm text-white/80 whitespace-nowrap flex items-center gap-2">
        <i class="fa-solid fa-users text-white/60"></i>
        Онлайн: <span class="js-online">…</span>
      </p>
    </div>
  </div>
</a>

<!-- ВАЖЛИВО: щоб кнопка копіювання не відкривала сторінку -->
<script is:inline>
  document.addEventListener("click", async (e) => {
    const btn = e.target.closest?.(".copy-ip");
    if (!btn) return;

    // зупиняємо клік по <a>
    e.preventDefault();
    e.stopPropagation();

    const ip = btn.dataset.ip || "";
    try {
      await navigator.clipboard.writeText(ip);

      const oldHTML = btn.innerHTML;
      btn.innerHTML = '<i class="fa-solid fa-check"></i> Скопійовано!';
      btn.classList.add("text-green-400");

      setTimeout(() => {
        btn.innerHTML = oldHTML;
        btn.classList.remove("text-green-400");
      }, 1200);
    } catch {
      alert("Не вдалося скопіювати. Спробуй вручну: " + ip);
    }
  });
</script>
